
<button id="btn">
    click me!
</button>

<button id="btn2">
    send hello via pub sub!
</button>

<script>
    function request() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                console.log(xhr.response);
                const obj = JSON.parse(xhr.response)
                console.log(obj.key);
            }
        }
        xhr.open('get', '/j', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        xhr.send();
    }

    document.getElementById("btn").onclick = function() {
        request()
    };

    function pubsub_send() {
        const topicNameOrId = 'projects/groovy-autumn-290918/topics/my-first-topic';
        const data = JSON.stringify({send_data: 'hello from pubsub'});

        // Imports the Google Cloud client library
        const {PubSub} = require('@google-cloud/pubsub');

        // Creates a client; cache this for further use
        const pubSubClient = new PubSub();

        async function publishMessage() {
        // Publishes the message as a string, e.g. "Hello, world!" or JSON.stringify(someObject)
        const dataBuffer = Buffer.from(data);

        try {
            const messageId = await pubSubClient
            .topic(topicNameOrId)
            .publishMessage({data: dataBuffer});
            console.log(`Message ${messageId} published.`);
        } catch (error) {
            console.error(`Received error while publishing: ${error.message}`);
            process.exitCode = 1;
        }
        }
    }

    document.getElementById("btn2").onclick = function() {
        pubsub_send()
    };
</script>